<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
    <title>Поймай Пикачу!</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        html,body{height:100%;width:100%;overflow:hidden;touch-action:pan-x pan-y pinch-zoom;}
        body{
            font-family:'Press Start 2P',cursive;
            background:#0b1b3a;color:#fff;
            height:100dvh;image-rendering:pixelated;
            background-image:
                radial-gradient(circle at 20% 80%,#5acaff 0%,transparent 50%),
                radial-gradient(circle at 80% 20%,#fffd99 0%,transparent 50%),
                linear-gradient(135deg,#1e5799 0%,#2989d8 50%,#207cca 51%,#7db9e8 100%);
        }
        h1{font-size:3rem;text-shadow:4px 4px #ff0000;margin-bottom:30px;line-height:1.3;}
        button{
            font-family:inherit;font-size:1.6rem;padding:20px 50px;
            background:#ff0000;color:#fff;border:6px solid #fff;
            box-shadow:8px 8px 0 #000;cursor:pointer;transition:all .1s;
        }
        button:active{transform:translate(4px,4px);box-shadow:4px 4px 0 #000;}

        #ui{
            position:fixed;top:15px;left:15px;right:15px;
            display:flex;justify-content:space-between;z-index:100;
            pointer-events:none;font-size:1.4rem;text-shadow:3px 3px #000;
        }
        #ui span{color:#ffff00;}

        #pikachu{
            position:absolute;width:120px;
            transform:translate(-50%,-50%);
            image-rendering:pixelated;z-index:10;
        }

        @keyframes pop{from{transform:translate(-50%,-50%) scale(0)}to{transform:translate(-50%,-50%) scale(1)}}
        @keyframes up{to{transform:translateY(-120px);opacity:0}}

        .plus-one{
            position:absolute;font-size:3rem;color:#ffff00;
            text-shadow:3px 3px #ff0000;pointer-events:none;
            animation:up .9s forwards;z-index:50;
        }

        #start-screen,#end-screen{
            position:fixed;inset:0;background:#000d;
            backdrop-filter:blur(6px);display:flex;
            flex-direction:column;align-items:center;
            justify-content:center;text-align:center;z-index:200;padding:20px;
        }
        #final-score{font-size:5.5rem;color:#ffff00;text-shadow:6px 6px #ff0000;}
        .share-btn{
            margin-top:50px;padding:22px 40px;
            background:#00ff41;color:#000;font-size:1.6rem;
            border:8px solid #fff;box-shadow:10px 10px 0 #000;
            animation:pulse 2s infinite;
        }
        @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}

        @media (max-width:600px){
            h1{font-size:1.8rem;}
            button{font-size:1.2rem;padding:15px 35px;}
            #ui{font-size:0.9rem;top:10px;}
            #pikachu{width:100px;}
            #final-score{font-size:3.5rem;}
            .share-btn{font-size:1.2rem;padding:18px 30px;margin-top:40px;}
        }
    </style>
</head>
<body>

    <audio id="hit" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA="></audio>

    <div id="start-screen">
        <h1>ПОЙМАЙ<br>ПИКАЧУ!</h1>
        <button onclick="startGame()">СТАРТ</button>
    </div>

    <div id="ui">
        <div>Счёт: <span id="score">0</span></div>
        <div>Время: <span id="timer">30</span></div>
        <div>Уровень: <span id="level">1</span></div>
    </div>

    <img id="pikachu" src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/versions/generation-v/black-white/animated/25.gif">

    <div id="end-screen" style="display:none">
        <h1>ВРЕМЯ ВЫШЛО!</h1>
        <div id="final-score">0</div>
        <p style="margin:25px 0;font-size:1.5rem">УРОВЕНЬ <span id="final-level">1</span></p>
        <button onclick="startGame()">СНОВА</button>
        <button class="share-btn" onclick="window.open('https://t.me/+kjTWCeGm_TgxMDJi','_blank')">
            СДЕЛАЙ СКРИНШОТ<br>И ОТПРАВЬ В КАНАЛ<br>ЗАБЕРИ ПРИЗ!
        </button>
    </div>

    <script>
        const p = document.getElementById('pikachu');
        const hit = document.getElementById('hit');
        const scoreEl = document.getElementById('score'), timerEl = document.getElementById('timer'), levelEl = document.getElementById('level');
        const finalScore = document.getElementById('final-score'), finalLevel = document.getElementById('final-level');

        let score = 0, time = 30, level = 1, vx = 8, vy = 8, running = false;
        const MAX_SPEED = 26;
        const PIKA_SIZE = 120; // ширина Пикачу в px

        // Функция безопасного телепорта
        function randPos() {
            const maxX = innerWidth - PIKA_SIZE;
            const maxY = innerHeight - PIKA_SIZE;
            const x = Math.max(PIKA_SIZE/2, Math.min(Math.random() * maxX + PIKA_SIZE/2, innerWidth - PIKA_SIZE/2));
            const y = Math.max(PIKA_SIZE/2, Math.min(Math.random() * maxY + PIKA_SIZE/2, innerHeight - PIKA_SIZE/2));
            p.style.left = x + 'px';
            p.style.top = y + 'px';
            p.style.animation = 'none';
            requestAnimationFrame(() => p.style.animation = 'pop .25s ease-out');
        }

        function plusOne(x,y){
            const el=document.createElement('div');el.className='plus-one';el.textContent='+1';
            el.style.left=x+'px';el.style.top=(y-50)+'px';document.body.appendChild(el);
            setTimeout(()=>el.remove(),900);
        }

        function startGame(){
            document.getElementById('start-screen').style.display='none';
            document.getElementById('end-screen').style.display='none';
            score=0;time=30;level=1;vx=8;vy=8;
            scoreEl.textContent=0;timerEl.textContent=30;levelEl.textContent=1;
            running=true;randPos();
            clearInterval(window.t);
            window.t=setInterval(()=>{if(--time<=0)endGame();timerEl.textContent=time;},1000);
            move();
        }

        function move(){
            if(!running)return;
            let x = parseFloat(p.style.left);
            let y = parseFloat(p.style.top);

            x += vx; y += vy;

            // Жёсткие границы — никогда не улетит
            if (x <= PIKA_SIZE/2 || x >= innerWidth - PIKA_SIZE/2) vx = -vx * 1.05;
            if (y <= PIKA_SIZE/2 || y >= innerHeight - PIKA_SIZE/2) vy = -vy * 1.05;

            // Дополнительная страховка
            x = Math.max(PIKA_SIZE/2, Math.min(x, innerWidth - PIKA_SIZE/2));
            y = Math.max(PIKA_SIZE/2, Math.min(y, innerHeight - PIKA_SIZE/2));

            p.style.left = x + 'px';
            p.style.top = y + 'px';
            requestAnimationFrame(move);
        }

        function catchPikachu(e){
            if(!running)return;e.preventDefault();
            score++;scoreEl.textContent=score;
            if(score%10===0)levelEl.textContent=++level;
            const t=e.touches?e.touches[0]:e;
            plusOne(t.clientX,t.clientY);
            hit.currentTime=0;hit.play().catch(()=>{});
            navigator.vibrate?.([50]);

            const boost = 1 + (score/300); // ещё медленнее растёт
            vx = Math.sign(vx)*Math.min(Math.abs(vx)*boost, MAX_SPEED);
            vy = Math.sign(vy)*Math.min(Math.abs(vy)*boost, MAX_SPEED);

            randPos();
        }

        function endGame(){
            running=false;clearInterval(window.t);
            finalScore.textContent=score;finalLevel.textContent=level;
            document.getElementById('end-screen').style.display='flex';
            navigator.vibrate?.(200);
        }

        p.addEventListener('click',catchPikachu);
        p.addEventListener('touchstart',catchPikachu);

        // Блокировка pull-to-refresh
        document.body.addEventListener('touchmove', e => {
            if (e.touches.length > 1) return;
            if (e.touches[0].clientY < 80) e.preventDefault();
        }, {passive:false});

        // Перерасчёт при повороте экрана
        window.addEventListener('resize', () => { if(running) randPos(); });
    </script>
</body>
</html>
